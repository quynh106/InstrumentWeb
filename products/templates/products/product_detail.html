{% extends "base.html" %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}{{ product.name }}{% endblock %}</title>
  </head>
  <body>
    {% block content %}

    <div class="container my-4">
      <!-- PRODUCT TOP SECTION -->
      <div class="row">
        <!-- LEFT IMAGE -->
        <div class="col-md-6">
          {% if product.image %}
          <img
            src="{{ product.image.url }}"
            class="img-fluid rounded shadow-sm"
            alt="{{ product.name }}"
          />
          {% else %}
          <img
            src="https://via.placeholder.com/600x450"
            class="img-fluid rounded shadow-sm"
            alt="{{ product.name }}"
          />
          {% endif %}
        </div>

        <!-- RIGHT DETAILS -->
        <div class="col-md-6">
          <h2 class="fw-bold">{{ product.name }}</h2>

          <!-- Rating -->
          <p class="mb-1">
            <span class="fw-bold fs-5">⭐ {{ average_rating }} / 5</span>
            <span class="text-muted">({{ total_reviews }} reviews)</span>
          </p>

          <!-- Price -->
          <p class="text-primary fw-bold fs-3">
            ${{ product.price|floatformat:2 }}
          </p>

          <!-- Quantity Selector -->
          <div class="d-flex align-items-center mb-3">
            <button class="btn btn-outline-secondary" onclick="changeQty(-1)">
              −
            </button>
            <input
              id="qtyInput"
              type="number"
              class="form-control mx-2"
              value="1"
              min="1"
              style="width: 70px"
            />
            <button class="btn btn-outline-secondary" onclick="changeQty(1)">
              +
            </button>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex gap-2">
            <a href="#" class="btn btn-success px-4">Add to Cart</a>
            <a href="#" class="btn btn-warning px-4">Buy Now</a>
          </div>

          <!-- Stock -->
          <p class="mt-3 text-muted">Stock: {{ product.stock }}</p>
        </div>
      </div>

      <hr />

      <!-- PRODUCT DESCRIPTION -->
      <h3>Description</h3>
      <p>{{ product.description|default:"No description available." }}</p>

      <hr />

      <!-- REVIEW SECTION -->
      <div class="mb-4">
        <h3 class="fw-bold">Customer Reviews</h3>

        <!-- Average rating + filter -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <span class="fw-bold fs-4">⭐ {{ average_rating }} / 5</span>
            <span class="text-muted">({{ total_reviews }} reviews)</span>
          </div>

          <!-- Star Filter Buttons -->
          <div class="btn-group">
            <a href="?star=all" class="btn btn-outline-primary btn-sm">All</a>
            <a href="?star=5" class="btn btn-outline-primary btn-sm">5 Stars</a>
            <a href="?star=4" class="btn btn-outline-primary btn-sm">4 Stars</a>
            <a href="?star=3" class="btn btn-outline-primary btn-sm">3 Stars</a>
            <a href="?star=2" class="btn btn-outline-primary btn-sm">2 Stars</a>
            <a href="?star=1" class="btn btn-outline-primary btn-sm">1 Star</a>
          </div>
        </div>

        <!-- Demo reviews -->
        <div class="container my-5">
          <h2 class="mb-4">Customer Reviews</h2>

          <!-- Review 1 -->
          <div class="border p-3 mb-3">
            <h5 class="mb-1">Emily Johnson</h5>
            <small class="text-muted">Reviewed on 2025-11-15</small>
            <div class="text-warning mb-2">★★★★☆</div>
            <p>
              The product was great and delivered on time. Customer service was
              very responsive and helpful.
            </p>

            <!-- Product Images in a row -->
            <div class="d-flex flex-wrap gap-2">
              <img
                src="https://www.pixelstalk.net/wp-content/uploads/2016/03/Pokemon-pikachu-hd-wallpaper-background.jpg"
                class="img-thumbnail"
                style="width: 100px"
                alt="Product Image 1"
              />
              <img
                src="https://cdn.pixabay.com/photo/2016/03/31/19/00/pikachu-1294307_1280.png"
                class="img-thumbnail"
                style="width: 100px"
                alt="Product Image 2"
              />
              <img
                src="https://www.pngmart.com/files/21/Pikachu-PNG-Picture.png"
                class="img-thumbnail"
                style="width: 100px"
                alt="Product Image 3"
              />
            </div>
          </div>

          <!-- Review 2 -->
          <div class="d-flex align-items-start border p-3 mb-3">
            <div class="flex-grow-1">
              <h5 class="mb-1">Michael Smith</h5>
              <small class="text-muted">Reviewed on 2025-11-10</small>
              <div class="text-warning">★★★★★</div>
              <p class="mb-1">
                Absolutely love it! High quality and easy to use. Will
                definitely buy again.
              </p>
            </div>
            <img
              src="https://via.placeholder.com/100x100?text=Product+2"
              class="ms-3"
              alt="Product Image"
            />
          </div>

          <!-- Review 3 -->
          <div class="d-flex align-items-start border p-3 mb-3">
            <div class="flex-grow-1">
              <h5 class="mb-1">Sophia Williams</h5>
              <small class="text-muted">Reviewed on 2025-11-08</small>
              <div class="text-warning">★★★☆☆</div>
              <p class="mb-1">
                The product works well, but delivery was a bit slow. Overall,
                satisfied with the purchase.
              </p>
            </div>
            <img
              src="https://via.placeholder.com/100x100?text=Product+3"
              class="ms-3"
              alt="Product Image"
            />
          </div>

          <!-- Review 4 -->
          <div class="d-flex align-items-start border p-3 mb-3">
            <div class="flex-grow-1">
              <h5 class="mb-1">David Brown</h5>
              <small class="text-muted">Reviewed on 2025-11-05</small>
              <div class="text-warning">★★★★☆</div>
              <p class="mb-1">
                Good product, value for money. Packaging could be improved, but
                satisfied overall.
              </p>
            </div>
            <img
              src="https://via.placeholder.com/100x100?text=Product+4"
              class="ms-3"
              alt="Product Image"
            />
          </div>
        </div>

        <!-- Review List -->
        {% for review in reviews %}
        <div class="border rounded p-3 mb-3 shadow-sm">
          <strong>{{ review.user.username }}</strong>
          <span class="text-warning">⭐ {{ review.rating }}</span>
          <p class="mb-1">{{ review.comment }}</p>
          <small class="text-muted"
            >{{ review.created_at|date:"M d, Y H:i" }}</small
          >
        </div>
        {% empty %}
        <p>No reviews available.</p>
        {% endfor %}
      </div>

      <hr />

      <!-- ADD REVIEW FORM -->
      <h4>Add a Review</h4>

      {% if user.is_authenticated %}
      <form method="post">
        {% csrf_token %}

        <div class="mb-3">
          <label class="form-label fw-bold">Rating</label>
          <select name="rating" class="form-select" required>
            <option value="">Select rating</option>
            {% for i in "54321" %}
            <option value="{{ i }}">{{ i }} Stars</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">Comment</label>
          <textarea
            name="comment"
            rows="3"
            class="form-control"
            required
          ></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Submit Review</button>
      </form>
      {% else %}
      <p><a href="/login">Login</a> to submit a review.</p>
      {% endif %}
    </div>

    <!-- Quantity Logic -->
    <script>
      function changeQty(val) {
        let qty = document.getElementById("qtyInput");
        let newVal = parseInt(qty.value) + val;
        if (newVal >= 1) qty.value = newVal;
      }
    </script>

    {% endblock %}
  </body>
</html>

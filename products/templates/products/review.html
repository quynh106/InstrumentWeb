{% extends "base.html" %}

{% block title %}Review{% endblock %} 

{% block content%}
<form method="POST" enctype="multipart/form-data">
  {% csrf_token %}
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card shadow-sm">
          <div class="card-body">
            <!-- Product Info -->
            <div class="d-flex align-items-center mb-4">
              {% if product.image %}
  <img
    src="{{ product.image.url }}"
    alt="{{ product.name }}"
    class="rounded border me-3"
    style="width: 70px; height: 70px; object-fit: cover"
  />
{% else %}
  <img
    src="https://via.placeholder.com/800x400"
    alt="{{ product.name }}"
    class="rounded border me-3"
    style="width: 70px; height: 70px; object-fit: cover"
  />
{% endif %}

              <h5 class="mb-0 fw-semibold">{{ product.name }}</h5>
            </div>

            <!-- Rating -->
            <div class="row align-items-center mb-3">
              <div class="col-6 fw-medium">Product Quality</div>

              <div class="col-6 text-end">
                <span class="fs-3 star" data-value="1">&#9733;</span>
                <span class="fs-3 star" data-value="2">&#9733;</span>
                <span class="fs-3 star" data-value="3">&#9733;</span>
                <span class="fs-3 star" data-value="4">&#9733;</span>
                <span class="fs-3 star" data-value="5">&#9733;</span>
              </div>

              <input type="hidden" id="ratingValue" name="rating" value="5" />
            </div>

            <!-- Upload Buttons -->
            <input
            type="file"
            id="imagesInput"
            name="images"
            accept="image/*"
            multiple
            hidden
          />
            <div class="row mb-3">
              <div class="col-6">
                <label for="imagesInput" class="btn btn-outline-secondary w-100">
                  ðŸ“· Add Image
                  
                </label>
              </div>

              <div class="col-6">
                <label class="btn btn-outline-secondary w-100">
                  ðŸŽ¥ Add Video
                  <input type="file" accept="video/*" hidden />
                </label>
              </div>
            </div>

            <!-- Preview container -->
<div id="preview" class="d-flex flex-wrap gap-2 mt-2"></div>

            <!-- Review Text -->
            <div class="mb-3">
              <textarea
                class="form-control"
                rows="5"
                name="comment"
                placeholder="Write your product review here..."
              ></textarea>
            </div>

            <!-- Submit -->
            <button class="btn btn-primary w-100">Submit Review</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

<!-- script chá»n sao-->
<script>
  const stars = document.querySelectorAll(".star");
  const ratingInput = document.getElementById("ratingValue");

  // --- Máº·c Ä‘á»‹nh 5 sao ---
  const defaultRating = 5;
  ratingInput.value = defaultRating;
  stars.forEach((s) => {
    s.style.cursor = "pointer";
    s.style.color =
      s.getAttribute("data-value") <= defaultRating ? "#ffc107" : "#ddd";
  });

  // --- Click Ä‘á»ƒ chá»n sao ---
  stars.forEach((star) => {
    star.addEventListener("click", () => {
      const rating = star.getAttribute("data-value");
      ratingInput.value = rating;

      stars.forEach((s) => {
        s.style.color =
          s.getAttribute("data-value") <= rating ? "#ffc107" : "#ddd";
      });
    });
  });
</script>

<!-- preview áº£nh Ä‘Ã£ chá»n review,Chá»n nhiá»u láº§n & XÃ³a áº£nh -->
<script>
  const input = document.getElementById("imagesInput");
  const preview = document.getElementById("preview");
  
  // Máº£ng lÆ°u cÃ¡c file Ä‘Ã£ chá»n
  let selectedFiles = [];
  
  // HÃ m hiá»ƒn thá»‹ preview
  function renderPreview() {
    preview.innerHTML = "";
    selectedFiles.forEach((file, index) => {
      const reader = new FileReader();
      reader.onload = function(e) {
        const wrapper = document.createElement("div");
        wrapper.style.position = "relative";
        wrapper.style.display = "inline-block";
  
        const img = document.createElement("img");
        img.src = e.target.result;
        img.style.width = "100px";
        img.style.height = "100px";
        img.style.objectFit = "cover";
        img.className = "img-thumbnail";
  
        // NÃºt xÃ³a
        const removeBtn = document.createElement("button");
        removeBtn.innerHTML = "&times;";
        removeBtn.style.position = "absolute";
        removeBtn.style.top = "0";
        removeBtn.style.right = "0";
        removeBtn.style.border = "none";
        removeBtn.style.background = "rgba(255,255,255,0.8)";
        removeBtn.style.cursor = "pointer";
        removeBtn.style.fontSize = "16px";
        removeBtn.onclick = () => {
          selectedFiles.splice(index, 1); // xÃ³a file khá»i máº£ng
          renderPreview();
        };
  
        wrapper.appendChild(img);
        wrapper.appendChild(removeBtn);
        preview.appendChild(wrapper);
      }
      reader.readAsDataURL(file);
    });
  }
  
  // Khi chá»n file má»›i
  input.addEventListener("change", function () {
    selectedFiles = selectedFiles.concat(Array.from(this.files)); // thÃªm file má»›i
    renderPreview();
  });
  
  // ThÃªm máº£ng file vÃ o form trÆ°á»›c submit
  const form = input.closest("form");
  form.addEventListener("submit", function(e) {
    const dataTransfer = new DataTransfer();
    selectedFiles.forEach(file => dataTransfer.items.add(file));
    input.files = dataTransfer.files; // ghi láº¡i vÃ o input
  });
  </script>
  
{%endblock%}
